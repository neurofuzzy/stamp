<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MVC Spreadsheet Tests</title>
    <style>
        body {
            font-family: monospace;
            background: #1a1a1a;
            color: #ffffff;
            padding: 20px;
        }
        .test-result {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
        }
        .pass {
            background: #2d5016;
            border: 1px solid #4caf50;
        }
        .fail {
            background: #5d1a1a;
            border: 1px solid #f44336;
        }
        .summary {
            margin-top: 20px;
            padding: 15px;
            background: #2d2d2d;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>SpreadsheetModel Tests</h1>
    <div id="results"></div>
    <div id="summary" class="summary"></div>

    <script>
        // Test model business logic
        class SpreadsheetModel {
            constructor() {
                this.commands = [{ name: '', nameIsLocked: false, parameters: [{ key: '', value: '', keyIsLocked: false }] }];
                this.focusPosition = { commandIndex: 0, paramIndex: 0, cellType: 'command' };
                this.cursorPosition = 0;
            }
            
            updateCommandName(commandIndex, name) {
                if (commandIndex >= 0 && commandIndex < this.commands.length) {
                    this.commands[commandIndex].name = name;
                    return commandIndex === this.commands.length - 1 && name.trim() !== '';
                }
                return false;
            }
            
            expandCommands() {
                this.commands.push({ name: '', nameIsLocked: false, parameters: [{ key: '', value: '', keyIsLocked: false }] });
            }
            
            lockCommand(commandIndex) {
                if (this.commands[commandIndex]) this.commands[commandIndex].nameIsLocked = true;
            }
            
            isCommandLocked(commandIndex) {
                return this.commands[commandIndex]?.nameIsLocked || false;
            }
        }

        function runTests() {
            const results = document.getElementById('results');
            let passed = 0, failed = 0;
            
            function test(name, fn) {
                try {
                    fn();
                    results.innerHTML += `<div class="pass">✓ ${name}</div>`;
                    passed++;
                } catch (e) {
                    results.innerHTML += `<div class="fail">✗ ${name}: ${e.message}</div>`;
                    failed++;
                }
            }
            
            function assertEqual(actual, expected) {
                if (actual !== expected) throw new Error(`Expected ${expected}, got ${actual}`);
            }
            
            // Tests
            test('Model initializes correctly', () => {
                const model = new SpreadsheetModel();
                assertEqual(model.commands.length, 1);
                assertEqual(model.commands[0].name, '');
            });
            
            test('Command update triggers expansion', () => {
                const model = new SpreadsheetModel();
                const shouldExpand = model.updateCommandName(0, 'circle');
                assertEqual(model.commands[0].name, 'circle');
                assertEqual(shouldExpand, true);
            });
            
            test('Command expansion works', () => {
                const model = new SpreadsheetModel();
                model.expandCommands();
                assertEqual(model.commands.length, 2);
            });
            
            test('Lock operations work', () => {
                const model = new SpreadsheetModel();
                model.lockCommand(0);
                assertEqual(model.isCommandLocked(0), true);
            });
            
            results.innerHTML += `<br><strong>Summary: ${passed} passed, ${failed} failed</strong>`;
        }
        
        runTests();
    </script>
</body>
</html> 